<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V·∫Ω ƒê·ªì Th·ªã 2D & 3D - To√°n H·ªçc</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            height: 100vh;
            background-color: #f5f5f5;
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        header h1 {
            font-size: 24px;
            font-weight: bold;
        }
        .mode-select {
            background: white;
            color: #667eea;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .mode-select:hover {
            opacity: 0.9;
        }
        .main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        .left-panel {
            width: 320px;
            border-right: 1px solid #e0e0e0;
            background: white;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .input-section {
            padding: 16px;
            border-bottom: 1px solid #e0e0e0;
        }
        .input-section h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        .input-wrapper {
            display: flex;
            gap: 8px;
        }
        .input-wrapper input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .input-wrapper button {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .input-wrapper button:hover {
            background: #764ba2;
        }
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
        }
        .mode-hint {
            background: #e8f4f8;
            border-left: 4px solid #45B7D1;
            padding: 10px;
            margin-bottom: 12px;
            border-radius: 4px;
            font-size: 12px;
            color: #333;
        }
        .mode-hint strong {
            display: block;
            color: #0277BD;
            margin-bottom: 4px;
        }
        .examples-section {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e0e0e0;
        }
        .examples-title {
            font-size: 13px;
            font-weight: 600;
            color: #667eea;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
            user-select: none;
        }
        .examples-title:hover {
            color: #764ba2;
        }
        .examples-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }
        .example-btn {
            text-align: left;
            padding: 10px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }
        .example-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        .example-btn .name {
            font-weight: 600;
            margin-bottom: 2px;
        }
        .example-btn .formula {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            opacity: 0.8;
        }
        .example-btn .desc {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 2px;
        }
        .functions-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .functions-section h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        .functions-list {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .function-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: #f5f5f5;
            border-radius: 4px;
            font-size: 12px;
        }
        .function-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .function-expr {
            flex: 1;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #333;
        }
        .delete-btn {
            padding: 4px 8px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
        }
        .delete-btn:hover {
            background: #ff5252;
        }
        .empty-message {
            text-align: center;
            color: #999;
            font-size: 12px;
            padding: 16px;
            font-style: italic;
        }
        .help-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e0e0e0;
            font-size: 11px;
            color: #666;
        }
        .help-section p {
            margin-bottom: 4px;
            line-height: 1.4;
        }
        .help-section strong {
            display: block;
            color: #333;
            margin-top: 6px;
            margin-bottom: 2px;
        }
        .right-panel {
            flex: 1;
            background: #fafafa;
            padding: 16px;
            overflow: hidden;
        }
        #canvas2d {
            width: 100%;
            height: 100%;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }
        #canvas3d {
            width: 100%;
            height: 100%;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }
        .zoom-info {
            position: absolute;
            bottom: 16px;
            right: 16px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 11px;
            display: none;
        }
        .zoom-info.visible {
            display: block;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>V·∫Ω ƒê·ªì Th·ªã 2D & 3D - To√°n H·ªçc</h1>
            <select id="modeSelect" class="mode-select">
                <option value="2d">üìä Ch·∫ø ƒë·ªô 2D (Oxy)</option>
                <option value="3d">üéØ Ch·∫ø ƒë·ªô 3D (Oxyz)</option>
            </select>
        </header>
        <div class="main">
            <div class="left-panel">
                <div class="input-section">
                    <h3>Nh·∫≠p ph∆∞∆°ng tr√¨nh</h3>
                    <div class="input-wrapper">
                        <input type="text" id="functionInput" placeholder="VD: sin(x) ho·∫∑c x=1">
                        <button onclick="addFunction()">Th√™m</button>
                    </div>
                </div>
                <div class="content">
                    <div id="modeHint" class="mode-hint">
                        <strong>üìã Ch·∫ø ƒë·ªô 2D:</strong>
                        Nh·∫≠p d·∫°ng: y = f(x)<br>
                        VD: sin(x), x^2, log(x)
                    </div>
                    <div class="examples-section">
                        <div class="examples-title" onclick="toggleExamples()">
                            <span id="exampleToggle">‚ñº</span>
                            V√≠ d·ª• nhanh
                        </div>
                        <div id="examplesContainer" class="examples-grid"></div>
                    </div>
                    <div class="functions-section">
                        <h3>Danh s√°ch ph∆∞∆°ng tr√¨nh</h3>
                        <div id="functionsList" class="functions-list"></div>
                    </div>
                    <div class="help-section">
                        <strong>H√†m h·ªó tr·ª£:</strong>
                        <p>sin, cos, tan, sqrt, abs, exp, log, pow</p>
                        <strong>To√°n t·ª≠:</strong>
                        <p>+, -, *, /, ^</p>
                        <strong>ƒê∆∞·ªùng th·∫≥ng ƒë·ª©ng:</strong>
                        <p>Nh·∫≠p: x=1, x=-2, x=3</p>
                        <strong>‚ùå L·ªói th∆∞·ªùng:</strong>
                        <p>Kh√¥ng d√πng: x+y=1, 2x+3y=6 (sai)<br>D√πng: y=1-3*(x) ho·∫∑c z=x+y (ƒë√∫ng)</p>
                    </div>
                </div>
            </div>
            <div class="right-panel">
                <canvas id="canvas2d"></canvas>
                <div id="canvas3d" class="hidden"></div>
                <div class="zoom-info" id="zoomInfo"></div>
            </div>
        </div>
    </div>
    <script>
        // State management
        const state = {
            mode: '2d',
            functions: [],
            showExamples: true,
            scene: null,
            renderer: null,
            camera: null,
            meshes: [],
            zoomLevel: 1
        };

        const EXAMPLES_2D = [
            { name: 'Parabol', formula: 'x^2', desc: 'y = x¬≤' },
            { name: 'Sine', formula: 'sin(x)', desc: 'y = sin(x)' },
            { name: 'Cosine', formula: 'cos(x)', desc: 'y = cos(x)' },
            { name: 'Line', formula: '1-x', desc: 'y = 1-x' },
            { name: 'Vertical', formula: 'x=1', desc: 'ƒê∆∞·ªùng th·∫≥ng ƒë·ª©ng' },
            { name: 'Absolute', formula: 'abs(x)', desc: 'y = |x|' }
        ];

        const EXAMPLES_3D = [
            { name: 'Parabol', formula: 'x^2 + y^2', desc: 'z = x¬≤ + y¬≤' },
            { name: 'Saddle', formula: 'x^2 - y^2', desc: 'z = x¬≤ - y¬≤' },
            { name: 'Wave', formula: 'sin(x)*cos(y)', desc: 'z = sin(x)cos(y)' },
            { name: 'Plane', formula: 'x+y', desc: 'z = x+y' },
            { name: 'Sphere', formula: 'sqrt(25 - x^2 - y^2)', desc: 'z = ‚àö(25-x¬≤-y¬≤)' },
            { name: 'Ripple', formula: 'sin(sqrt(x^2+y^2))', desc: 'z = sin(‚àö(x¬≤+y¬≤))' }
        ];

        const COLORS = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE'];

        // <CHANGE> Parse vertical lines like x=1 or y=2
        function parseEquation(input) {
            const trimmed = input.trim().toLowerCase();
            
            // Check for vertical or horizontal lines (x=value, y=value)
            if (trimmed.includes('=')) {
                const parts = trimmed.split('=');
                const left = parts[0].trim();
                const right = parts[1].trim();
                
                // Vertical line: x=1
                if (left === 'x' && /^-?\d+\.?\d*$/.test(right)) {
                    return { type: 'vertical', value: parseFloat(right) };
                }
                
                // Horizontal line: y=1
                if (left === 'y' && /^-?\d+\.?\d*$/.test(right)) {
                    return { type: 'horizontal', value: parseFloat(right) };
                }
                
                if (state.mode === '2d') {
                    if (left === 'y') {
                        return { type: 'function', value: right };
                    }
                } else {
                    if (left === 'z') {
                        return { type: 'function', value: right };
                    }
                }
            }
            
            return { type: 'function', value: trimmed };
        }

        // Math expression evaluator
        function evaluateExpression(expression, variables) {
            let expr = expression.toLowerCase();
            Object.entries(variables).forEach(([key, value]) => {
                expr = expr.replace(new RegExp(`\\b${key}\\b`, 'g'), `(${value})`);
            });
            expr = expr.replace(/sin\(/g, 'Math.sin(');
            expr = expr.replace(/cos\(/g, 'Math.cos(');
            expr = expr.replace(/tan\(/g, 'Math.tan(');
            expr = expr.replace(/sqrt\(/g, 'Math.sqrt(');
            expr = expr.replace(/abs\(/g, 'Math.abs(');
            expr = expr.replace(/exp\(/g, 'Math.exp(');
            expr = expr.replace(/log\(/g, 'Math.log(');
            expr = expr.replace(/log10\(/g, 'Math.log10(');
            expr = expr.replace(/pow\(/g, 'Math.pow(');
            expr = expr.replace(/asin\(/g, 'Math.asin(');
            expr = expr.replace(/acos\(/g, 'Math.acos(');
            expr = expr.replace(/atan\(/g, 'Math.atan(');
            expr = expr.replace(/sinh\(/g, 'Math.sinh(');
            expr = expr.replace(/cosh\(/g, 'Math.cosh(');
            expr = expr.replace(/tanh\(/g, 'Math.tanh(');
            expr = expr.replace(/\^/g, '**');
            expr = expr.replace(/œÄ/g, 'Math.PI');
            expr = expr.replace(/\be\b/g, 'Math.E');
            try {
                return eval(expr);
            } catch {
                return NaN;
            }
        }

        // UI Functions
        function updateExamples() {
            const container = document.getElementById('examplesContainer');
            const examples = state.mode === '3d' ? EXAMPLES_3D : EXAMPLES_2D;
            const modeHint = document.getElementById('modeHint');
            
            if (state.mode === '2d') {
                modeHint.innerHTML = `<strong>üìã Ch·∫ø ƒë·ªô 2D (Oxy):</strong>
                Nh·∫≠p d·∫°ng: y = f(x), x=c<br>
                VD: sin(x), x^2, x=1`;
            } else {
                modeHint.innerHTML = `<strong>üìã Ch·∫ø ƒë·ªô 3D (Oxyz):</strong>
                Nh·∫≠p d·∫°ng: z = f(x,y)<br>
                VD: x^2+y^2, sin(x)*cos(y)`;
            }

            if (!state.showExamples) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = examples.map((ex, idx) => `
                <button class="example-btn" onclick="addFunctionFromExample('${ex.formula}')">
                    <div class="name">${ex.name}</div>
                    <div class="formula">${ex.formula}</div>
                    <div class="desc">${ex.desc}</div>
                </button>
            `).join('');
        }

        function toggleExamples() {
            state.showExamples = !state.showExamples;
            document.getElementById('exampleToggle').textContent = state.showExamples ? '‚ñº' : '‚ñ∂';
            updateExamples();
        }

        function addFunctionFromExample(formula) {
            document.getElementById('functionInput').value = formula;
            addFunction();
        }

        function addFunction() {
            const input = document.getElementById('functionInput');
            let expression = input.value.trim();
            if (!expression) return;

            const parsed = parseEquation(expression);
            const id = Math.random().toString(36).substr(2, 9);
            const color = COLORS[Math.floor(Math.random() * COLORS.length)];

            state.functions.push({
                id,
                type: parsed.type,
                expression: parsed.value,
                color,
                originalInput: expression
            });

            input.value = '';
            updateFunctionsList();
            render();
        }

        function removeFunction(id) {
            state.functions = state.functions.filter(f => f.id !== id);
            updateFunctionsList();
            render();
        }

        function updateFunctionsList() {
            const list = document.getElementById('functionsList');
            if (state.functions.length === 0) {
                list.innerHTML = '<div class="empty-message">Ch∆∞a c√≥ ph∆∞∆°ng tr√¨nh n√†o</div>';
                return;
            }
            list.innerHTML = state.functions.map(func => `
                <div class="function-item">
                    <div class="function-color" style="background-color: ${func.color}"></div>
                    <div class="function-expr">${func.originalInput}</div>
                    <button class="delete-btn" onclick="removeFunction('${func.id}')">X√≥a</button>
                </div>
            `).join('');
        }

        function switchMode(mode) {
            state.mode = mode;
            const canvas2d = document.getElementById('canvas2d');
            const canvas3d = document.getElementById('canvas3d');
            if (mode === '2d') {
                canvas2d.classList.remove('hidden');
                canvas3d.classList.add('hidden');
            } else {
                canvas2d.classList.add('hidden');
                canvas3d.classList.remove('hidden');
            }
            updateExamples();
            render();
        }

        // <CHANGE> Updated render2D to handle vertical and horizontal lines
        function render2D() {
            const canvas = document.getElementById('canvas2d');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const scale = 40;

            // Draw axes
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, canvas.height);
            ctx.stroke();

            // Draw grid
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = -50; i <= 50; i++) {
                if (i !== 0) {
                    ctx.beginPath();
                    ctx.moveTo(centerX + i * scale, 0);
                    ctx.lineTo(centerX + i * scale, canvas.height);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(0, centerY + i * scale);
                    ctx.lineTo(canvas.width, centerY + i * scale);
                    ctx.stroke();
                }
            }

            // Draw axis labels
            ctx.fillStyle = '#000';
            ctx.font = '12px Arial';
            ctx.fillText('X', canvas.width - 20, centerY + 15);
            ctx.fillText('Y', centerX - 15, 15);

            // Draw functions
            state.functions.forEach(func => {
                ctx.strokeStyle = func.color;
                ctx.lineWidth = 2;

                if (func.type === 'vertical') {
                    // Draw vertical line
                    const px = centerX + func.expression * scale;
                    ctx.beginPath();
                    ctx.moveTo(px, 0);
                    ctx.lineTo(px, canvas.height);
                    ctx.stroke();
                } else if (func.type === 'horizontal') {
                    // Draw horizontal line
                    const py = centerY - func.expression * scale;
                    ctx.beginPath();
                    ctx.moveTo(0, py);
                    ctx.lineTo(canvas.width, py);
                    ctx.stroke();
                } else {
                    // Draw regular function
                    ctx.beginPath();
                    for (let px = 0; px < canvas.width; px++) {
                        const x = (px - centerX) / scale;
                        try {
                            const y = evaluateExpression(func.expression, { x });
                            const py = centerY - y * scale;
                            if (px === 0) {
                                ctx.moveTo(px, py);
                            } else {
                                ctx.lineTo(px, py);
                            }
                        } catch (e) {
                            // Skip invalid points
                        }
                    }
                    ctx.stroke();
                }
            });
        }

        // 3D Rendering with Three.js
        function init3D() {
            const container = document.getElementById('canvas3d');
            if (state.scene) return;

            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0xfafafa);
            state.scene = scene;

            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(8, 8, 8);
            camera.lookAt(0, 0, 0);
            state.camera = camera;

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);
            state.renderer = renderer;

            // Axes and grid
            const axesHelper = new THREE.AxesHelper(5);
            scene.add(axesHelper);
            const gridHelper = new THREE.GridHelper(10, 10, 0xcccccc, 0xeeeeee);
            scene.add(gridHelper);

            // Lighting
            const light = new THREE.DirectionalLight(0xffffff, 0.7);
            light.position.set(5, 5, 5);
            scene.add(light);
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
            scene.add(ambientLight);

            // Mouse controls
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };

            renderer.domElement.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });

            renderer.domElement.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                const deltaX = e.clientX - previousMousePosition.x;
                const deltaY = e.clientY - previousMousePosition.y;
                camera.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), deltaX * 0.01);
                camera.position.applyAxisAngle(
                    new THREE.Vector3().crossVectors(camera.position, new THREE.Vector3(0, 0, 1)).normalize(),
                    deltaY * 0.01
                );
                camera.lookAt(0, 0, 0);
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });

            renderer.domElement.addEventListener('mouseup', () => {
                isDragging = false;
            });

            renderer.domElement.addEventListener('wheel', (e) => {
                e.preventDefault();
                const currentDistance = state.camera.position.length();
                const zoomSensitivity = 1.2;
                let newDistance;

                if (e.deltaY < 0) {
                    newDistance = currentDistance / zoomSensitivity;
                } else {
                    newDistance = currentDistance * zoomSensitivity;
                }

                if (newDistance > 2 && newDistance < 100) {
                    const direction = state.camera.position.clone().normalize();
                    state.zoomLevel = newDistance / 8;
                    state.camera.position.copy(direction.multiplyScalar(newDistance));
                    state.camera.lookAt(0, 0, 0);

                    const zoomInfo = document.getElementById('zoomInfo');
                    zoomInfo.textContent = `Zoom: ${(state.zoomLevel * 100).toFixed(0)}%`;
                    zoomInfo.classList.add('visible');
                    clearTimeout(zoomInfo.timeout);
                    zoomInfo.timeout = setTimeout(() => zoomInfo.classList.remove('visible'), 1000);
                }
            });

            window.addEventListener('resize', () => {
                if (state.renderer) {
                    const width = container.clientWidth;
                    const height = container.clientHeight;
                    state.camera.aspect = width / height;
                    state.camera.updateProjectionMatrix();
                    state.renderer.setSize(width, height);
                }
            });

            const animate = () => {
                requestAnimationFrame(animate);
                state.renderer.render(state.scene, state.camera);
            };
            animate();
        }

        function render3D() {
            if (!state.scene) {
                init3D();
            }

            state.meshes.forEach(mesh => {
                state.scene.remove(mesh);
            });
            state.meshes = [];

            state.functions.forEach(func => {
                if (func.type !== 'function') return;
                
                try {
                    const geometry = new THREE.BufferGeometry();
                    const vertices = [];
                    const indices = [];
                    const range = 5;
                    const step = 0.3;
                    let vertexIndex = 0;

                    for (let x = -range; x <= range; x += step) {
                        for (let y = -range; y <= range; y += step) {
                            try {
                                const z = evaluateExpression(func.expression, { x, y });
                                if (typeof z === 'number' && isFinite(z) && Math.abs(z) < 50) {
                                    vertices.push(x, z, y);
                                    vertexIndex++;
                                }
                            } catch (e) {}
                        }
                    }

                    indices.length = 0;
                    vertexIndex = 0;
                    const verticesPerRow = Math.round((range * 2) / step) + 1;

                    for (let x = -range; x < range; x += step) {
                        for (let y = -range; y < range; y += step) {
                            const a = vertexIndex;
                            const b = vertexIndex + 1;
                            const c = vertexIndex + verticesPerRow;
                            const d = vertexIndex + verticesPerRow + 1;

                            if (vertices.length > d * 3) {
                                indices.push(a, b, c);
                                indices.push(b, d, c);
                            }
                            vertexIndex++;
                        }
                    }

                    if (vertices.length > 0) {
                        geometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array(vertices), 3));
                        if (indices.length > 0) {
                            geometry.setIndex(new THREE.BufferAttribute(new Uint32Array(indices), 1));
                        }
                        geometry.computeVertexNormals();

                        const material = new THREE.MeshPhongMaterial({
                            color: func.color,
                            emissive: 0x000000,
                            shininess: 100,
                            side: THREE.DoubleSide
                        });

                        const mesh = new THREE.Mesh(geometry, material);
                        state.scene.add(mesh);
                        state.meshes.push(mesh);
                    }
                } catch (e) {
                    console.error(`Error plotting function: ${func.expression}`);
                }
            });
        }

        function render() {
            if (state.mode === '2d') {
                render2D();
            } else {
                render3D();
            }
        }

        // Event listeners
        document.getElementById('modeSelect').addEventListener('change', (e) => {
            switchMode(e.target.value);
        });

        document.getElementById('functionInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addFunction();
            }
        });

        // Initialize
        updateExamples();
        updateFunctionsList();
        render();
    </script>
</body>
</html>